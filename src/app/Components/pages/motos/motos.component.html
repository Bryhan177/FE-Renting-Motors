<div class="overflow-x-auto mt-6 px-4 sm:px-6 lg:px-8">
  <h2 class="font-bold mb-4 text-center text-secondary text-xl sm:text-2xl lg:text-4xl">
    Registrar nueva moto üõµ
  </h2>

  <!-- Formulario -->
  <div class="bg-secondary p-3 sm:p-4 rounded shadow mb-6">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
      <input
        type="text"
        placeholder="Marca"
        [(ngModel)]="nuevaMoto.marca"
        class="border p-2 rounded w-full text-sm sm:text-base"
        [class.border-red-500]="formularioInvalido && !nuevaMoto.marca"
      />

      <input
        type="text"
        placeholder="Modelo"
        [(ngModel)]="nuevaMoto.modelo"
        class="border p-2 rounded w-full text-sm sm:text-base"
        [class.border-red-500]="formularioInvalido && !nuevaMoto.modelo"
      />

      <input
        type="text"
        placeholder="Placa"
        [(ngModel)]="nuevaMoto.placa"
        class="border p-2 rounded w-full text-sm sm:text-base"
        [class.border-red-500]="formularioInvalido && !nuevaMoto.placa"
      />

      <select [(ngModel)]="nuevaMoto.estado" class="border p-2 rounded w-full text-sm sm:text-base">
        <option value="">Seleccionar estado</option>
        <option value="disponible">Disponible</option>
        <option value="en_uso">En uso</option>
        <option value="en_mantenimiento">Mantenimiento</option>
        <option value="fuera_servicio">Fuera de servicio</option>
      </select>
    </div>

    <div *ngIf="formularioInvalido" class="text-red-600 font-semibold mt-2 text-sm sm:text-base">
      ‚ö†Ô∏è Por favor completa todos los campos requeridos.
    </div>

    <button
      (click)="agregarMoto()"
      class="mt-4 bg-green-500 hover:bg-green-600 text-white px-3 sm:px-4 py-2 rounded w-full sm:w-auto text-sm sm:text-base"
    >
      Agregar moto ‚úÖ
    </button>
  </div>

  <!-- Tabla -->
  <div class="overflow-x-auto rounded-lg shadow mb-6">
    <table class="min-w-full bg-secondary border border-gray-200 text-xs sm:text-sm lg:text-base">
      <thead class="bg-secondary text-white">
        <tr>
          <th class="px-2 sm:px-4 py-2 text-left whitespace-nowrap">Marca</th>
          <th class="px-2 sm:px-4 py-2 text-left whitespace-nowrap">Modelo</th>
          <th class="px-2 sm:px-4 py-2 text-left whitespace-nowrap">Placa</th>
          <th class="px-2 sm:px-4 py-2 text-left whitespace-nowrap">Estado</th>
          <th class="px-2 sm:px-4 py-2 text-left whitespace-nowrap">Conductor</th>
          <th class="px-2 sm:px-4 py-2 text-left whitespace-nowrap">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let moto of motos" class="border-t bg-white">
          <td class="px-2 sm:px-4 py-2 font-medium">{{ moto.marca }}</td>
          <td class="px-2 sm:px-4 py-2">{{ moto.modelo }}</td>
          <td class="px-2 sm:px-4 py-2">{{ moto.placa }}</td>
          <td class="px-2 sm:px-4 py-2">
            <span
              [ngClass]="{
                'text-green-600 font-bold': moto.estado === 'disponible',
                'text-blue-600 font-bold': moto.estado === 'en_uso',
                'text-yellow-500 font-bold': moto.estado === 'en_mantenimiento',
                'text-red-500 font-bold': moto.estado === 'fuera_servicio'
              }"
            >
              <span *ngIf="moto.estado === 'disponible'">üü¢</span>
              <span *ngIf="moto.estado === 'en_uso'">üîµ</span>
              <span *ngIf="moto.estado === 'en_mantenimiento'">üü°</span>
              <span *ngIf="moto.estado === 'fuera_servicio'">üî¥</span>
              <span class="hidden sm:inline">{{ moto.estado }}</span>
            </span>
          </td>
          <td class="px-2 sm:px-4 py-2">
            <span *ngIf="moto.conductor; else sinConductor">
              {{ moto.conductor.nombre }} {{ moto.conductor.apellido }}
            </span>
            <ng-template #sinConductor>
              <span class="text-gray-500">Sin asignar</span>
            </ng-template>
          </td>
          <td class="px-2 sm:px-4 py-2">
            <div class="flex flex-col sm:flex-row gap-1">
              <button
                (click)="abrirModal(moto)"
                class="bg-blue-500 hover:bg-blue-600 text-white px-2 sm:px-3 py-1 rounded flex items-center gap-1 text-xs sm:text-sm"
              >
                <span>‚úèÔ∏è</span> <span class="hidden sm:inline">Editar</span>
              </button>
              <button
                *ngIf="!moto.conductorId"
                (click)="abrirModalAsignar(moto)"
                class="bg-green-500 hover:bg-green-600 text-white px-2 sm:px-3 py-1 rounded flex items-center gap-1 text-xs sm:text-sm"
              >
                <span>üë§</span> <span class="hidden sm:inline">Asignar</span>
              </button>
              <button
                *ngIf="moto.conductorId"
                (click)="removerConductor(moto._id!)"
                class="bg-orange-500 hover:bg-orange-600 text-white px-2 sm:px-3 py-1 rounded flex items-center gap-1 text-xs sm:text-sm"
              >
                <span>üö´</span> <span class="hidden sm:inline">Remover</span>
              </button>
              <button
                (click)="eliminarMoto(moto._id!)"
                class="bg-red-500 hover:bg-red-600 text-white px-2 sm:px-3 py-1 rounded flex items-center gap-1 text-xs sm:text-sm"
              >
                <span>üóëÔ∏è</span> <span class="hidden sm:inline">Eliminar</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Responsive -->
<div *ngIf="modalVisible" class="fixed inset-0 flex justify-center items-center bg-gray-900 bg-opacity-50 px-4 z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full sm:w-2/3 md:w-1/2 max-w-lg max-h-[90vh] overflow-y-auto">
    <h2 class="text-xl font-bold mb-4">Editar Moto</h2>
    <form (ngSubmit)="editarMoto()">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label for="marca" class="block">Marca</label>
          <input id="marca" type="text" [(ngModel)]="motoEditada.marca" name="marca" class="border p-2 w-full" required />
        </div>
        <div>
          <label for="modelo" class="block">Modelo</label>
          <input id="modelo" type="text" [(ngModel)]="motoEditada.modelo" name="modelo" class="border p-2 w-full" required />
        </div>
        <div>
          <label for="placa" class="block">Placa</label>
          <input id="placa" type="text" [(ngModel)]="motoEditada.placa" name="placa" class="border p-2 w-full" required />
        </div>
        <div>
          <label for="estado" class="block">Estado</label>
          <select id="estado" [(ngModel)]="motoEditada.estado" name="estado" class="border p-2 w-full" required>
            <option value="">Seleccionar estado</option>
            <option value="disponible">Disponible</option>
            <option value="en_uso">En uso</option>
            <option value="en_mantenimiento">Mantenimiento</option>
            <option value="fuera_servicio">Fuera de servicio</option>
          </select>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row justify-end gap-2 mt-4">
        <button
          type="button"
          class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded w-full sm:w-auto"
          (click)="cerrarModal()"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded w-full sm:w-auto"
        >
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Asignar Conductor -->
<div *ngIf="modalAsignarVisible" class="fixed inset-0 flex justify-center items-center bg-gray-900 bg-opacity-50 px-4 z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full sm:w-2/3 md:w-1/2 max-w-lg max-h-[90vh] overflow-y-auto">
    <h2 class="text-xl font-bold mb-4">Asignar Conductor</h2>
    <p class="mb-4">Moto: {{ motoSeleccionada?.marca }} {{ motoSeleccionada?.modelo }} - {{ motoSeleccionada?.placa }}</p>

    <div *ngIf="conductoresDisponibles.length === 0" class="text-center py-8">
      <p class="text-gray-500">No hay conductores disponibles</p>
    </div>

    <div *ngIf="conductoresDisponibles.length > 0" class="space-y-2 max-h-60 overflow-y-auto">
      <div *ngFor="let conductor of conductoresDisponibles"
           class="flex items-center justify-between p-3 border rounded hover:bg-gray-50">
        <div>
          <p class="font-medium">{{ conductor.nombre }} {{ conductor.apellido }}</p>
          <p class="text-sm text-gray-600">C√©dula: {{ conductor.cedula }}</p>
        </div>
        <button
          (click)="asignarConductor(conductor._id!)"
          class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded"
        >
          Asignar
        </button>
      </div>
    </div>

    <div class="flex justify-end mt-4">
      <button
        type="button"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded"
        (click)="cerrarModalAsignar()"
      >
        Cancelar
      </button>
    </div>
  </div>
</div>
