<div class="px-4 sm:px-6 lg:px-8">
  <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-secondary text-center mb-4">üìã Hola</h2>

  <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-2">
    <button (click)="toggleVistaReportes()"
            class="bg-blue-600 hover:bg-blue-700 text-white px-3 sm:px-4 py-2 rounded flex items-center gap-1 text-sm sm:text-base">
      <span>üìä</span> <span>{{ vistaReportes ? 'Ver Usuarios' : 'Ver Reportes' }}</span>
    </button>

    <button *ngIf="!vistaReportes" (click)="abrirModal()"
            class="bg-green-600 hover:bg-green-700 text-white px-3 sm:px-4 py-2 rounded flex items-center gap-1 text-sm sm:text-base">
      <span>‚ûï</span> <span>Agregar Usuario</span>
    </button>
  </div>

  <div class="overflow-x-auto rounded-lg shadow">
    <table class="min-w-full bg-white rounded text-xs sm:text-sm lg:text-base">
      <thead class="bg-gray-100 text-left">
        <tr>
          <th class="px-2 sm:px-4 py-2">Nombre</th>
          <th class="px-2 sm:px-4 py-2 hidden sm:table-cell">Apellido</th>
          <th class="px-2 sm:px-4 py-2 hidden md:table-cell">Correo</th>
          <th class="px-2 sm:px-4 py-2">Cedula</th>
          <th class="px-2 sm:px-4 py-2 hidden lg:table-cell">Tel</th>
          <th class="px-2 sm:px-4 py-2">Rol</th>
          <th class="px-2 sm:px-4 py-2">Estado</th>
          <th class="px-2 sm:px-4 py-2">Asignaci√≥n</th>
          <th class="px-2 sm:px-4 py-2">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-t" *ngFor="let usuario of usuarios" [ngClass]="{'bg-red-50': !usuario.activo}">
          <td class="px-2 sm:px-4 py-2 font-medium">{{ usuario.nombre }}</td>
          <td class="px-2 sm:px-4 py-2 hidden sm:table-cell">{{ usuario.apellido }}</td>
          <td class="px-2 sm:px-4 py-2 hidden md:table-cell">{{ usuario.email }}</td>
          <td class="px-2 sm:px-4 py-2 hidden lg:table-cell">{{ usuario.cedula }}</td>
          <td class="px-2 sm:px-4 py-2 hidden md:table-cell">{{ usuario.telefono }}</td>
          <td class="px-2 sm:px-4 py-2">
            <span class="px-2 py-1 rounded text-xs font-medium"
                  [ngClass]="{
                    'bg-blue-100 text-blue-800': usuario.rol === 'administrador',
                    'bg-green-100 text-green-800': usuario.rol === 'empleado',
                    'bg-yellow-100 text-yellow-800': usuario.rol === 'asesor'
                  }">
              {{ usuario.rol }}
            </span>
          </td>
          <td class="px-2 sm:px-4 py-2">
            <span class="px-2 py-1 rounded text-xs font-medium"
                  [ngClass]="{
                    'bg-green-100 text-green-800': usuario.activo,
                    'bg-red-100 text-red-800': !usuario.activo
                  }">
              {{ usuario.activo ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td class="px-2 sm:px-4 py-2">
            <span class="px-2 py-1 rounded text-xs font-medium"
                  [ngClass]="getEstadoAsignacionClass(usuario._id!)"
                  *ngIf="usuario.rol === 'empleado'">
              {{ getEstadoAsignacionTexto(usuario._id!) }}
            </span>
            <span class="text-gray-400 text-xs" *ngIf="usuario.rol !== 'empleado'">
              N/A
            </span>
          </td>
          <td class="px-2 sm:px-4 py-2">
            <div class="flex flex-col sm:flex-row gap-1 sm:gap-2">
              <button (click)="editarUsuario(usuario)" class="bg-yellow-500 hover:bg-yellow-600 text-white px-2 sm:px-3 py-1 rounded flex items-center justify-center gap-1 text-xs">
                <span>‚úèÔ∏è</span><span class="hidden sm:inline">Editar</span>
              </button>
              <button (click)="eliminarUsuario(usuario._id!)" class="bg-red-500 hover:bg-red-600 text-white px-2 sm:px-3 py-1 rounded flex items-center justify-center gap-1 text-xs">
                <span>ÔøΩÔøΩÔ∏è</span><span class="hidden sm:inline">Eliminar</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Vista de Reportes (condicional) -->
  <div *ngIf="vistaReportes" class="space-y-6 mt-8">
    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-secondary text-center">üìä Reporte Semanal de Ingresos</h2>

    <!-- Selector de semana -->
    <div class="flex flex-col sm:flex-row items-center gap-4 mb-6">
      <label class="font-semibold text-sm sm:text-base">Semana:</label>
      <input [(ngModel)]="semanaSeleccionada" (change)="cambiarSemana()"
             type="week" class="border p-2 rounded text-sm sm:text-base" />
    </div>

    <!-- Resumen general -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-blue-800">Total Ingresos</h3>
        <p class="text-2xl font-bold text-blue-600">$ {{ getTotalIngresosSemana() | number }}</p>
        <p class="text-sm text-blue-700">Semana {{ semanaSeleccionada }}</p>
      </div>
      <div class="bg-green-50 border border-green-200 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-green-800">Conductores Activos</h3>
        <p class="text-2xl font-bold text-green-600">{{ getConductoresConPagos().length }}</p>
        <p class="text-sm text-green-700">Con pagos registrados</p>
      </div>
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-yellow-800">Al D√≠a</h3>
        <p class="text-2xl font-bold text-yellow-600">{{ getConductoresAlDia().length }}</p>
        <p class="text-sm text-yellow-700">Pagos completados</p>
      </div>
      <div class="bg-red-50 border border-red-200 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-red-800">Pendientes</h3>
        <p class="text-2xl font-bold text-red-600">{{ getConductoresPendientes().length }}</p>
        <p class="text-sm text-red-700">Pagos por cobrar</p>
      </div>
    </div>

    <!-- Detalle por conductor -->
    <div class="bg-white border border-gray-200 rounded-lg shadow">
      <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-800">üí∞ Detalle de Ingresos por Conductor</h3>
      </div>
      <div class="p-4">
        <div class="space-y-4">
          <div *ngFor="let conductor of getConductoresConPagos()"
               class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-gray-50 rounded border border-gray-200">
            <div class="flex-1">
              <p class="font-semibold text-gray-800">
                {{ conductor.nombre }} {{ conductor.apellido }}
              </p>
              <p class="text-sm text-gray-600">C√©dula: {{ conductor.cedula }}</p>
              <p class="text-sm text-gray-600">Tel: {{ conductor.telefono }}</p>
            </div>
            <div class="flex items-center gap-4 mt-2 sm:mt-0">
              <div class="text-right">
                <p class="text-lg font-bold text-green-600">$ {{ getIngresosPorConductor(conductor._id!) | number }}</p>
                <p class="text-sm text-gray-500">{{ getPagosPorConductor(conductor._id!).length }} pagos</p>
              </div>
              <span [class]="getEstadoConductorClass(conductor._id!)"
                    class="px-3 py-1 rounded-full text-sm font-semibold">
                {{ getEstadoConductorTexto(conductor._id!) }}
              </span>
            </div>
          </div>
        </div>
        <p *ngIf="getConductoresConPagos().length === 0" class="text-center text-gray-500 py-8">
          No hay conductores con pagos registrados para esta semana.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Modal unificado para agregar/editar empleado -->
<div *ngIf="mostrarModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 px-4">
  <div class="bg-white p-4 sm:p-6 rounded shadow-md w-full max-w-sm sm:max-w-md">
    <h2 class="text-lg sm:text-xl font-semibold mb-4">{{ modoEdicion ? 'Editar Usuario' : 'Agregar Usuario' }}</h2>
    <form (ngSubmit)="agregarUsuario()" #formUsuario="ngForm" class="space-y-3">
      <input type="text" [(ngModel)]="nuevoUsuario.nombre" name="nombre" placeholder="Nombre" required class="w-full p-2 border rounded text-sm sm:text-base" [class.border-red-500]="formUsuario.submitted && !nuevoUsuario.nombre" />
      <input type="text" [(ngModel)]="nuevoUsuario.apellido" name="apellido" placeholder="Apellido" required class="w-full p-2 border rounded text-sm sm:text-base" [class.border-red-500]="formUsuario.submitted && !nuevoUsuario.apellido" />
      <input type="email" [(ngModel)]="nuevoUsuario.email" name="email" placeholder="Email" required class="w-full p-2 border rounded text-sm sm:text-base" [class.border-red-500]="formUsuario.submitted && !nuevoUsuario.email" />
      <input type="number" [(ngModel)]="nuevoUsuario.cedula" name="cedula" placeholder="Cedula" required class="w-full p-2 border rounded text-sm sm:text-base" [class.border-red-500]="formUsuario.submitted && !nuevoUsuario.cedula" />
      <input type="text" [(ngModel)]="nuevoUsuario.telefono" name="telefono" placeholder="Tel√©fono" required class="w-full p-2 border rounded text-sm sm:text-base" [class.border-red-500]="formUsuario.submitted && !nuevoUsuario.telefono" />

      <select [(ngModel)]="nuevoUsuario.rol" name="rol" required class="w-full p-2 border rounded text-sm sm:text-base">
        <option value="administrador">Administrador</option>
        <option value="asesor">Asesor</option>
        <option value="usuario">Usuario</option>
        <option value="empleado">Empleado</option>
      </select>

      <div class="flex items-center space-x-2">
        <input type="checkbox" [(ngModel)]="nuevoUsuario.activo" name="activo" class="rounded">
        <label class="text-sm sm:text-base">Usuario activo</label>
      </div>

      <div class="flex flex-col sm:flex-row justify-between gap-2">
        <button type="submit" class="bg-green-600 text-white px-3 sm:px-4 py-2 rounded hover:bg-green-700 flex items-center justify-center gap-1 text-sm sm:text-base">
          <span>üíæ</span> {{ modoEdicion ? 'Guardar cambios' : 'Guardar' }}
        </button>
        <button type="button" (click)="cerrarModal()" class="text-red-500 text-sm sm:text-base">Cancelar</button>
      </div>
    </form>
  </div>
</div>
